<?php 
namespace WdevAmar\ProductImageInvoice\Model\Order\Pdf;
class Invoice extends \Magento\Sales\Model\Order\Pdf\Invoice
{
	protected $_localeResolver;
 protected function _drawHeader(\Zend_Pdf_Page $page)
 {
   /* Add table head */
       $this->_setFontRegular($page, 10);
       $page->setFillColor(new \Zend_Pdf_Color_RGB(0.93, 0.92, 0.92));
       $page->setLineColor(new \Zend_Pdf_Color_GrayScale(0.5));
       $page->setLineWidth(0.5);
       $page->drawRectangle(25, $this->y, 570, $this->y - 15);
   $this->y -= 10;
       $page->setFillColor(new \Zend_Pdf_Color_RGB(0, 0, 0));
   //columns headers
   $lines[0][] = ['text' => __('Products'), 'feed' => 35];
   $lines[0][] = ['text' => __('Product Image'), 'feed' => 200];
   $lines[0][] = ['text' => __('SKU'), 'feed' => 370, 'align' => 'right'];
   $lines[0][] = ['text' => __('Qty'), 'feed' => 475, 'align' => 'right'];
   $lines[0][] = ['text' => __('Price'), 'feed' => 425, 'align' => 'right'];
   $lines[0][] = ['text' => __('Tax'), 'feed' => 515, 'align' => 'right'];
   $lines[0][] = ['text' => __('Subtotal'), 'feed' => 565, 'align' => 'right'];
   $lineBlock = ['lines' => $lines, 'height' => 5];
       $this->drawLineBlocks($page, [$lineBlock], ['table_header' => true]);
       $page->setFillColor(new \Zend_Pdf_Color_GrayScale(0));
   $this->y -= 20;
 }
           /**
 * Return PDF document
 *
 * @param array|Collection $invoices
 * @return \Zend_Pdf
 */
 public function getPdf($invoices = [])
 {
        $this->_beforeGetPdf();
   $this->_initRenderer('invoice');
   
   $pdf = new \Zend_Pdf();
       $this->_setPdf($pdf);
   $style = new \Zend_Pdf_Style();
       $this->_setFontBold($style, 10);
   foreach ($invoices as $invoice) {
       if ($invoice->getStoreId()) {
            //    $this->_localeResolver->emulate($invoice->getStoreId());
               $this->_storeManager->setCurrentStore($invoice->getStoreId());
       }
       $page = $this->newPage();
       $order = $invoice->getOrder();
       /* Add image */
           $this->insertLogo($page, $invoice->getStore());
       /* Add address */
           $this->insertAddress($page, $invoice->getStore());
       /* Add head */
       $this->insertOrder(
           $page,
               $order,
               $this->_scopeConfig->isSetFlag(
                   self::XML_PATH_SALES_PDF_INVOICE_PUT_ORDER_ID,
                   \Magento\Store\Model\ScopeInterface::SCOPE_STORE,
                   $order->getStoreId()
           )
       );
       /* Add document text and number */
           $this->insertDocumentNumber($page, __('Invoice # ') . $invoice->getIncrementId());
       /* Add table */
        $this->_drawHeader($page);
       /* Add body */
       foreach ($invoice->getAllItems() as $item) {
           if ($item->getOrderItem()->getParentItem()) {
                   continue;
           }
           /* Draw item */
               $this->_drawItem($item, $page, $order);
           $page = end($pdf->pages);
       }
       /* Add totals */
           $this->insertTotals($page, $invoice);
       if ($invoice->getStoreId()) {
            //    $this->_localeResolver->revert();
       }
   }
       $this->_afterGetPdf();
   return $pdf;
 }
 
 public function drawLineBlocks(\Zend_Pdf_Page $page, array $draw, array $pageSettings = [], $flag = 0)
 {
   foreach ($draw as $itemsProp) {
       if (!isset($itemsProp['lines']) || !is_array($itemsProp['lines'])) {
           throw new \Magento\Framework\Exception\LocalizedException(
                   __('We don\'t recognize the draw line data. Please define the "lines" array.')
           );
       }
       $lines = $itemsProp['lines'];
       $height = isset($itemsProp['height']) ? $itemsProp['height'] : 10;
       if (empty($itemsProp['shift'])) {
           $shift = 0;
               foreach ($lines as $line) {
                   $maxHeight = 0;
                   foreach ($line as $column) {
                       $lineSpacing = !empty($column['height']) ? $column['height'] : $height;
                       if (!is_array($column['text'])) {
                           $column['text'] = [$column['text']];
                       }
                       $top = 0;
                       foreach ($column['text'] as $part) {
                       $top += $lineSpacing;
                       }
                       $maxHeight = $top > $maxHeight ? $top : $maxHeight;
               }
                   $shift += $maxHeight;
           }
               $itemsProp['shift'] = $shift;
       }
       if ($this->y - $itemsProp['shift'] < 15) { $page = $this->newPage($pageSettings);
       }
       foreach ($lines as $line) {
               $maxHeight = 0;
           $i = 0;
            if (($this->y - 100) < 15) { $page = $this->newPage($pageSettings);
           }
               foreach ($line as $column) {
                   if($i == 1 && $flag){
                       $i++;
                       if(array_key_exists('is_image', $column) && !is_null($column['text'])){
                           $image = \Zend_Pdf_Image::imageWithPath($column['text']);
                           $feed = $column['feed'];
                        $page->drawImage($image, $feed, $this->y-40, $feed+70, $this->y+10);
                           $maxHeight = 100;
                       }
                       continue 1;
               }
                   $i++;
                   $fontSize = empty($column['font_size']) ? 10 : $column['font_size'];
               if (!empty($column['font_file'])) {
                       $font = \Zend_Pdf_Font::fontWithPath($column['font_file']);
                       $page->setFont($font, $fontSize);
               } else {
                       $fontStyle = empty($column['font']) ? 'regular' : $column['font'];
                       switch ($fontStyle) {
                           case 'bold':
                           $font = $this->_setFontBold($page, $fontSize);
                           break;
                           case 'italic':
                           $font = $this->_setFontItalic($page, $fontSize);
                           break;
                        default:
                           $font = $this->_setFontRegular($page, $fontSize);
                           break;
                       }
               }
               if (!is_array($column['text'])) {
                       $column['text'] = [$column['text']];
               }
                   $lineSpacing = !empty($column['height']) ? $column['height'] : $height;
                   $top = 0;
                   foreach ($column['text'] as $part) {
                       if ($this->y - $lineSpacing < 15) { $page = $this->newPage($pageSettings);
                       }
                       $feed = $column['feed'];
                       $textAlign = empty($column['align']) ? 'left' : $column['align'];
                       $width = empty($column['width']) ? 0 : $column['width'];
                       switch ($textAlign) {
                           case 'right':
                           if ($width) {
                               $feed = $this->getAlignRight($part, $feed, $width, $font, $fontSize);
                           } else {
                               $feed = $feed - $this->widthForStringUsingFontSize($part, $font, $fontSize);
                           }
                           break;
                           case 'center':
                           if ($width) {
                               $feed = $this->getAlignCenter($part, $feed, $width, $font, $fontSize);
                           }
                           break;
                           default:
                           break;
                       }
                       $page->drawText($part, $feed, $this->y - $top, 'UTF-8');
                       $top += $lineSpacing;
               }
                   //$maxHeight = 100;
                   $maxHeight = $top > $maxHeight ? $top : $maxHeight;
           }
               $this->y -= $maxHeight;
       }
   }
   return $page;
 }
           
}